# Student Course Enrollment Coding Challenge

## Scope
As per the developer's understanding of the coding challenge, this project facilitates managing student enrollments in courses, providing functionalities for creating, retrieving, updating, and deleting these enrollments. It serves as a centralized system for managing student-course associations efficiently. 

This project comprises two distinct components:

1. student-api: This component hosts API endpoints responsible for managing CRUD operations related to student enrollments in courses. It facilitates creating, retrieving, updating, and deleting student enrollments efficiently.
2. course-api: This component encompasses API endpoints dedicated to managing CRUD operations for the Course entity. It offers functionalities for seamlessly handling course-related operations, ensuring effective management of Course data.

## Assumptions
Below are the assumptions considered during the design of this application:
1. Endpoints of this application will be invoked as a webservice call, there will be no user interface available.
2. The project features a straightforward security solution utilizing API Key authentication. For simplicity, only one API key is configured in the application.properties file to control access. As the project evolves, a more sophisticated API key management solution can be explored and implemented to enhance security further.
3. The project initializes the Student and Course tables with initial data, which is hardcoded and loaded upon application startup. This approach ensures that essential data is readily available in the database, streamlining the application's functionality from the outset. As the project matures, more dynamic and scalable methods for data initialization can be considered and implemented.

## Design Rationale
At a high level, both components (student-api and course-api) consist of the following key components:

1. Entity Classes: These classes define the structure and metadata of the Student, StudentCourses, and Course objects, providing a blueprint for storing and manipulating data.
2. Controller Classes: Responsible for implementing CRUD operations for the StudentCourses and Course entities, these classes serve as the entry points for handling incoming requests and orchestrating interactions with the underlying data.
3. JpaRepository Classes: These classes encapsulate database operations, including querying, saving, updating, and deleting data. They provide a convenient abstraction layer over database interactions, promoting modularity and ease of maintenance.
4. Service Classes: Acting as intermediaries between the Controller classes and JpaRepository classes, these classes contain business logic and perform data manipulation tasks. They help maintain separation of concerns and ensure that the Controller classes remain focused on request handling and response generation.
5. Test Classes: These classes contain unit tests for the Controller and Service classes to ensure the correctness and robustness of the implemented functionality. They cover various scenarios and edge cases to validate the behavior of the application components under different conditions.

## Implementation
The applications are written in Java 17. The source tree is structured using the standard Maven project layout and dependency management is handled via Maven.

## Design Architecture
### course-api
#### Entity Class
The Course class represents the entity for the course table in the database, encapsulating information about each course object. It includes the following attributes:
1. Id: An autogenerated unique identifier for each course record.
2. Name: The name of the course, providing a descriptive title for identification.
3. Code: An alphanumeric value serving as the unique code for the course. Each code must be unique across all records in the database, ensuring integrity and consistency.
4. Description: A brief description providing additional context or information about the course content, aiding in understanding its scope and objectives.
5. Deleted: A flag indicating whether the course has been deleted. By default, the value of this flag is set to "N" (No), indicating that the course is active. Upon deletion, the flag is updated to "Y" (Yes), signifying that the course has been removed from active use.

To minimize/remove the boilerplate code, Lombok library is used.

#### Service Class
``CourseService`` is the service class that contains business logic when performing data manipulation tasks. Several business logics implemented are:
1. New Course for creation must have a unique Code.
2. Update and Delete tasks must be for existing Course record only.

#### Repository Class
``CourseRepository`` class handles all the database operations.

#### Controller Class
``CourseController`` is the controller class of this application that contains the implementation of the following endpoints:
1. GET /api/course - Returns all Course record in the database.
2. GET /api/course/{code} - Returns the information about the Course having the input {code}
3. POST /api/course - creates a new Course record
4. PUT /api/course/{code} - updates an existing Course record having the input code
5. DELETE /api/course/{code} - delete an existing Course record having the input code

These api endpoints are documented in the swagger-endpoint that can be accessed via ``http://<server>:<port>/public/swagger-ui/index.html`` URL.

#### Main Class
The main entry point of the application is the ``CoursesApiApplication`` that starts a Spring web application using 
embedded tomcat as the server. Configurations about the application server are configured in the application.properties file.

### student-api
#### Entity Class
* ``Student`` class holds the information about the student object. For simplicity this entity contains the Id, Name and Age attributes.
* ``StudentCourses`` classes holds the information about the courses a student is enrolled on to. It includes the following attributes:
    * id: Auto generated record id
    * student: The student enrolled to the course reference by ID in the Student table
    * courseName: The name of the course the student is enrolled on
    * courseCode: The code of the course the student is enrolled on 
    * courseDescription: The description of the course the student is enrolled on 

To minimize/remove the boilerplate code, Lombok library is used.

#### Model Class
The Course class serves as a container for holding information about a course object within the course-api project. When the GET /api/course/{code} endpoint is invoked, an instance of the Course class is created to represent the retrieved course data.

Upon retrieval, the Course instance is then transformed into a StudentCourses object, which likely occurs within the business logic or service layer of the application. This transformation process involves mapping the attributes of the Course object to the corresponding attributes of the StudentCourse object, ensuring that the necessary course information is accurately represented in the context of student enrollments.

#### Service Class
* ``StudentService`` and ``StudentCoursesService`` classes are service classes that contains business logic when performing data manipulation tasks for Student and StudentCourses entities, respectively.

* ``CourseApiService`` class is the class that invokes the course-api endpoints to retrieve the Course data.

#### Repository Class
``StudentRepository`` and ``StudentCoursesRepository`` classes handles the database operations for Student and StudentCourses tables, respectively.

#### Controller Class
* ``StudentController`` class implements the endpoints that will perform CRUD operation to Student entity.
* ``StudentCoursesController`` class implements the endpoints that will perform CRUD operations to StudentCourses entity. Below are the details about these operations:
    * GET /api/student/courses/{studentId} - retrieves all the enrolled courses for the student having the input student id
    * POST /api/student/courses/{studentId}/{code} - Add course enrollment for the student. For this endpoint it performs following communication to course-api:
        * Invoke GET /api/course/{code} 
        * If the Course having the input code is available and NOT deleted (i.e., deleted flag is N), create a new record in StudentCourses table (if not yet enrolled).
        * If the Course record is NOT available or has been deleted, return NOT_FOUND error
        
        Below is the flow of communications for this endpoint:
        ```sequence
        student-api-client -> student-api: GET /api/student/courses/{studentId}/{code} 
        student-api -> course-api: GET /api/course/{code}
            Possible Results: 
                course-api -> student-api: Found it! Here are the details.
                    student-api: Is the Course still active? Yes!
                        student-api -> student-api-client: Success!
                    student-api: Is the Course still active? No!
                        student-api -> student-api-client: Course NOT FOUND!
                course-api -> student-api: I can't find it. NOT_FOUND.
                    student-api -> student-api-client: Course NOT FOUND!
        ```
    * PUT /api/student/courses/{studentId}/{code} - Update the details of a course enrollment, focusing on modifying the course name and description. Upon invoking the GET /api/course/{code} endpoint of the course-api, the relevant information is updated if the course data is available. The same flow of communication is followed innthe POST operation endpoint.
    * DELETE /api/student/courses/{studentId}/{code} - Remove the course to the list of enrolled course for the student.

These api endpoints are documented in the swagger-endpoint that can be accessed via ``http://<server>:<port>/public/swagger-ui/index.html`` URL.

#### Main Class
The main entry point of the application is the ``StudentApiApplication`` that starts a Spring web application using 
embedded tomcat as the server. Configurations about the application server are configured in the application.properties file.

## Error Handling
To maintain simplicity, both applications (course-api and student-api) currently returns standard HTTP error codes to the caller application for any encountered errors. However, for future enhancements, a more sophisticated ErrorResponse object can be implemented. This object would provide meaningful error details tailored to the specific error scenarios instead of relying solely on the standard error details returned by the Spring Boot framework.

## Security
Both projects feature a straightforward security solution utilizing API Key authentication, using Spring Security framework. For simplicity, only one API key is configured in the application.properties file to control access. As the project evolves, a more sophisticated API key management solution can be explored and implemented to enhance security further. The following are the security classes implemented for the ApiKey authentication:
* ApiKeyAuth: Stores the authentication token.
* ApiKeyAuthExtractor: Extracts the value of the *x-api-key* from the request header. If the header is available and is equal to the expected api key configured in the application.properties, and instance of the Authentication object is returned.
* ApiKeyAuthFilter: The filter class responsible for invoking the extract() method of the ApiKeyAuthExtractor. If an Authentication object is successfully extracted, it is stored in the SecurityContextHolder, ensuring its availability during the invocation of the API endpoint.

## Health Check
Utilizing the Spring Boot Actuator framework, you can assess the health status of different components within the application by accessing the following endpoints:

*Course API Health Endpoint:*
* URL: http://localhost:8081/public/course-api/health
* Description: This endpoint provides basic health information related to the Course API. Currently, it offers simple health details, but in subsequent versions, additional relevant metrics and status information can be configured and exposed.

*Student API Health Endpoint:*
* URL: http://localhost:8080/public/student-api/health
* Description: Similarly, this endpoint facilitates the retrieval of health status specific to the Student API. Similar to the Course API, the health endpoint for the Student API offers fundamental health data, with provisions for enhancing and configuring more comprehensive health metrics in future iterations.

These health endpoints offer a convenient means to monitor the overall health and stability of the application's components. As the application evolves, additional health checks and metrics can be integrated to provide more insightful information about the system's operational status and performance.

## How to Run the Application
Requirements: Java 17, Maven 3

1. Run course-api project
```
mvn package
java -jar target/course-api.jar
```

2. Run student-api project
```
mvn package
java -jar target/student-api.jar
```

## Testing Endpoints
### API documentation
Visit the following URLs to more details about the API endpoints:
* course-api: http://localhost:8081/public/swagger-ui/index.html
* student-api: http://localhost:8080/public/swagger-ui/index.html

### Test Data
The project initializes the Student and Course tables with initial data, which is hardcoded and loaded upon application startup. You can use the following sample data when invoking the necessary endpoints:
* Student Id: {1, 2, 3, 4}
* Course code: {"CS01", "CS02", "CS03", "CS04"}

#### API Keys
To invoke the endpoints of the projects, use the following Api Keys:
* course-api: 268d7f300e113cf987e1a1bdb151ae8e
* student-api: 146f5e1cb6a309cfbc05b8bca5ad3ef0
